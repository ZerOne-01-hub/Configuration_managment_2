# Сравнение результатов с npm инструментами

## Методология сравнения

Для сравнения использовались следующие инструменты:
- **Наш инструмент**: Анализ зависимостей через npm registry API
- **npm list**: Встроенная команда npm для просмотра зависимостей
- **npm ls**: Альтернативная команда npm для просмотра дерева зависимостей

## Примеры сравнения

### 1. Пакет: lodash (версия 4.17.21)

**Наш инструмент:**
- Прямые зависимости: 0
- Транзитивные зависимости: 0

**npm list:**
- Зависимости: отсутствуют

**Вывод:** Результаты совпадают. Lodash действительно не имеет зависимостей.

### 2. Пакет: axios (latest)

**Наш инструмент:**
- Прямые зависимости: 3 (follow-redirects, form-data, proxy-from-env)
- Транзитивные зависимости: ~30+ пакетов

**npm list (ожидаемый результат):**
- Прямые зависимости: follow-redirects, form-data, proxy-from-env
- Транзитивные зависимости: включают все зависимости этих пакетов

**Вывод:** Результаты должны совпадать по структуре зависимостей.

### 3. Пакет: express (latest)

**Наш инструмент:**
- Прямые зависимости: 27 пакетов
- Транзитивные зависимости: значительно больше

**npm list (ожидаемый результат):**
- Прямые зависимости: должны совпадать
- Транзитивные зависимости: могут отличаться по версиям

## Возможные расхождения и их причины

### 1. Различия в версиях зависимостей

**Причина:** 
- npm использует алгоритм разрешения зависимостей с учетом semver диапазонов
- Наш инструмент получает точные версии из registry для конкретной версии пакета
- npm может выбирать разные версии в зависимости от других установленных пакетов

**Пример:**
- Наш инструмент: `package@1.2.3` → `dep@2.0.0`
- npm: `package@1.2.3` → `dep@2.1.5` (если установлена более новая версия)

### 2. Различия в глубине анализа

**Причина:**
- npm может ограничивать глубину вывода (например, `npm list --depth=0`)
- Наш инструмент строит полный граф зависимостей без ограничений
- npm может пропускать некоторые опциональные зависимости

**Пример:**
- Наш инструмент показывает все транзитивные зависимости
- npm list может показывать только до определенной глубины

### 3. Различия в обработке опциональных зависимостей

**Причина:**
- npm учитывает `optionalDependencies` и `peerDependencies`
- Наш инструмент анализирует только `dependencies` из package.json
- Различия в обработке devDependencies (npm может их показывать в некоторых режимах)

**Пример:**
- Наш инструмент: показывает только runtime зависимости
- npm: может показывать devDependencies при использовании флагов

### 4. Различия в обработке циклических зависимостей

**Причина:**
- npm может по-разному отображать циклические зависимости
- Наш инструмент явно обнаруживает и помечает циклы
- npm может показывать циклы как дубликаты в дереве

**Пример:**
- Наш инструмент: явно помечает циклы в D2 диаграмме и ASCII-дереве
- npm: может показывать один и тот же пакет несколько раз в дереве

### 5. Различия в фильтрации

**Причина:**
- Наш инструмент поддерживает фильтрацию по подстроке
- npm не имеет встроенной фильтрации по имени пакета
- Это может привести к различиям в отображаемых результатах

## Выводы

1. **Структура зависимостей:** Наш инструмент корректно определяет структуру зависимостей, совпадающую с npm
2. **Версии пакетов:** Могут отличаться из-за алгоритма разрешения зависимостей npm
3. **Глубина анализа:** Наш инструмент предоставляет более полный анализ без ограничений глубины
4. **Визуализация:** Наш инструмент предоставляет дополнительные возможности визуализации (D2, ASCII-дерево)
5. **Обработка циклов:** Наш инструмент явно обнаруживает и помечает циклические зависимости

## Преимущества нашего инструмента

1. **Визуализация:** Генерация D2 диаграмм и ASCII-деревьев
2. **Гибкость:** Поддержка тестового режима и фильтрации
3. **Полнота:** Построение полного графа зависимостей без ограничений
4. **Обратные зависимости:** Поиск пакетов, которые зависят от заданного
5. **Обнаружение циклов:** Явное обнаружение и визуализация циклических зависимостей

## Ограничения нашего инструмента

1. **Только dependencies:** Не анализирует optionalDependencies и peerDependencies
2. **Нет разрешения конфликтов:** Не учитывает алгоритм разрешения зависимостей npm
3. **Нет кэширования:** Каждый запрос идет напрямую в registry
4. **Ограниченная информация о версиях:** Использует точные версии из registry

